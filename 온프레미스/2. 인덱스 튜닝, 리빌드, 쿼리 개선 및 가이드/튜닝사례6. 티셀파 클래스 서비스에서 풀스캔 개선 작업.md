# 데이터베이스 성능 최적화 및 IO 부하 개선 성과

## 1. 개요

* **목적**: 서비스 호출 빈도가 높은 주요 테이블의 인덱스를 최적화하여 시스템 자원(CPU, IO) 부하를 낮추고 응답 속도를 향상시킴
* **대상 시스템**: `TsherpaClass`, `GGEnglish2011` 외

---

## 2. 주요 개선 사례 요약

| 대상 테이블 | 주요 문제점 | 개선 조치 | 성과 (논리적 읽기) |
| --- | --- | --- | --- |
| **sh_content** | 단일 행 조회 시 10만 건 이상의 I/O 발생 | 복합 인덱스(`post_id`, `board_type`) 생성 | **106,149 → 3** |
| **Tbl_Mem_Login_His** | 로그인 이력 조회 시 약 700만 건 전수 스캔 | 비클러스터형 인덱스(`Site`, `RegDate`) 생성 | **133,653 → 10** |
| **tsherpa_info** | 클래스 삭제 작업 시 테이블 풀 스캔 발생 | 비클러스터형 인덱스(`createuserKey`) 생성 | **57,798 → 0** (Index Seek) |

![0 TsherpaClass에서 확인된 테이블 풀 스캔](https://github.com/user-attachments/assets/0d6524f3-6f66-47f1-99cd-fbd2409a5e61)


---

## 3. 사례별 상세 분석

### ① `sh_content` 테이블 최적화

* **현황**: MaxGauge 모니터링 결과, 특정 콘텐츠 호출 시 CPU 및 IO 피크 발생이 확인되었습니다.
* **원인**: `post_id`와 `board_type` 조건에 맞는 인덱스가 없어 불필요한 페이지를 과다하게 읽었습니다.
* **결과**: 인덱스 생성 후 읽기량이 **약 35,000배 감소**하며 쿼리 성능이 극대화되었습니다.

### ② `Tbl_Mem_Login_His` 테이블 최적화

* **현황**: `GGEnglish2011` 로그인 이력 집계 시 초당 논리적 읽기 수가 267,477건에 달하며 서버 부하의 주범이 되었습니다.
* **원인**: "Clustered Index Scan" 방식으로 전체 데이터를 조회하여 예상 연산자 비용이 98.32%에 육박했습니다.
* **결과**: 인덱스 생성 후 **"Index Seek"**로 전환되어 실행 비용이 0.001 수준으로 낮아졌습니다.

![1 TsherpaClass에 NON클러스터드 인덱스 생성](https://github.com/user-attachments/assets/c46ff939-3292-4d26-a425-391f735cc5ba)


### ③ `tsherpa_info` 테이블 최적화

* **현황**: 대량의 클래스 삭제(DeleteClassJob) 쿼리 수행 시 성능 저하가 감지되었습니다.
* **원인**: 실행 계획 상에서 "테이블 스캔"이 발생하며 98%의 비용을 점유하고 있었습니다.
* **결과**: `IDX_tsherpa_info_CreUserKey` 인덱스 적용 후, 57,798건이던 논리적 읽기가 **0건**에 가깝게 최적화되었습니다.

![2 TsherpaClass에 NON클러스터드 인덱스 실행계획 확인](https://github.com/user-attachments/assets/01143116-236c-4f1b-93f9-3e11bcddc48e)


---

## 4. 기술적 인사이트 (Technical Insight)

* **Scan에서 Seek로의 전환**: 세 사례 모두 수백만 건의 데이터를 전수 조사하던 방식에서, 필요한 데이터가 있는 위치로 즉시 찾아가는(Seek) 방식으로 실행 계획이 변경되었습니다.
* **리소스 선순환**: 특정 쿼리의 I/O가 감소하면 시스템 전체의 Disk I/O 대기(Wait)가 줄어들어, 다른 서비스 쿼리들의 처리 속도까지 동반 상승하는 효과를 거둘 수 있습니다.

---

## 5. 향후 계획

* 모니터링 툴을 활용해 `Logical Reads/s`가 높은 쿼리를 상시 추출하여 예방적 인덱스 튜닝을 지속하겠습니다.
* 데이터 증가 추이에 따라 기존 인덱스의 파편화율을 점검하고 재구성(Rebuild) 작업을 병행할 예정입니다.
