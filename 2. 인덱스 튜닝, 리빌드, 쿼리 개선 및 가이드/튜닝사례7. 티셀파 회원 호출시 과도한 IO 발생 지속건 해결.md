# DB 인덱스 최적화를 통한 IO 부하 개선

## 1. 현황 및 문제점 (Diagnosis)

* **증상:** `TsherpaClass` 서비스에서 `sh_content` 테이블 호출 시 서버 IO 부하 및 CPU 사용량 급증 현상 발생 (MaxGauge 모니터링 확인).
* **원인 분석:**
* 조회 조건(`post_id`, `board_type`)에 부합하는 인덱스가 없어 데이터 추출 시 테이블 전체 또는 비효율적인 범위를 스캔함.
* **개선 전 IO 수치:** 단일 행 조회 시 **논리적 읽기 106,149회** 발생.

<img width="1899" height="768" alt="TsherpaClass에서 sh_contetn 호출 시 과도한 IO 발생내역" src="https://github.com/user-attachments/assets/2b8b190d-47ee-4399-9466-dffe46ca6c1e" />
<img width="2043" height="843" alt="인덱스 생성 전" src="https://github.com/user-attachments/assets/5b3bfaa6-36c0-469d-92ed-c4af26b4f97b" />



## 2. 개선 조치 (Optimization)

* **인덱스 생성:** 조회 성능을 최적화하기 위해 조건절에 사용되는 컬럼을 조합하여 복합 인덱스 생성.
* **생성 내역:** * **인덱스명:** `IX_sh_content_post_id_board_type`
* **대상 컬럼:** `post_id`, `board_type`
* **형태:** Non-clustered Index

[인덱스 생성]

<img width="1241" height="662" alt="생성된 인덱스" src="https://github.com/user-attachments/assets/eb61c753-d6b2-41e6-a4fe-e22e51d4cc96" />

[인덱스 생성 후]

<img width="2078" height="901" alt="인덱스 생성 후" src="https://github.com/user-attachments/assets/07a3d45a-f5aa-47e4-bf16-821eb7fc76cc" />


## 3. 개선 결과 (Results)

| 항목 | 개선 전 (Before) | 개선 후 (After) | 개선 효과 |
| --- | --- | --- | --- |
| **논리적 읽기 (Logical Reads)** | **106,149** | **3** | **약 99.99% 절감** |
| **스캔 수 (Scan count)** | 13 | 1 | 효율적인 Index Seek 수행 |
| **시스템 부하** | IO 및 CPU 피크 발생 | 리소스 사용량 안정화 | 응답 속도 대폭 향상 |

## 4. 상세 분석

* **IO 효율성:** 기존에는 1건의 데이터를 찾기 위해 약 10만 개 이상의 페이지를 메모리에서 뒤져야 했으나, 인덱스 생성 후 단 3개의 페이지만 참조하여 원하는 결과를 즉시 찾아냄 (Index Seek).
* **서비스 영향:** 해당 쿼리가 빈번하게 호출되는 서비스 특성상, 전체 DB 서버의 병목 현상을 해결하고 타 쿼리의 실행 속도까지 보장하는 효과를 거둠.

---

## 5. 결론 및 향후 계획

이번 개선을 통해 특정 쿼리의 성능을 극대화했을 뿐만 아니라, 서버 전체의 IO 자원을 확보할 수 있었습니다. 향후에도 MaxGauge 등 모니터링 툴을 활용하여 **논리적 읽기 수가 높은(High IO) 쿼리**를 지속적으로 추출하고, 실행 계획 분석을 통해 인덱스 최적화 작업을 상시 진행할 예정입니다.

---
