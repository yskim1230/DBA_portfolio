# [보고서] CardViewLog 인덱스 최적화를 통한 CPU 및 IO 부하 개선

## 1. 현황 및 문제점 (Diagnosis)

* **증상**: `Chunjae_KOC` 데이터베이스에서 카드 정보 조회 시 CPU 점유율이 최대 **95.8%**까지 급증하며 서비스 지연 발생.
* **원인 분석**:
* 조회 조건인 `CardIdx` 및 `CardType`에 최적화된 인덱스가 없어 데이터 추출 시 비효율적인 스캔 발생.
* **개선 전 성능 지표**:
* **논리적 읽기**: **300,044회** 발생.
* **CPU 시간**: 약 **4,705ms** 소요.
* **대기 시간(Wait Time)**: 약 **1,775ms** 발생.



## 2. 개선 조치 (Optimization)

* **인덱스 튜닝**: 검색 조건인 `CardIdx`를 키 컬럼으로 하고, 자주 조회되는 `CardType`을 포함(Include)하는 비클러스터형 인덱스를 생성하여 테이블 접근을 최소화함.
* **생성 내역**:
* **인덱스명**: `IDX_CardViewLog_CardIdxCardType`
* **구성**: `CardIdx` (Key), `CardType` (Include)



## 3. 개선 결과 (Results)

| 항목 | 개선 전 (Before) | 개선 후 (After) | 개선 효과 |
| --- | --- | --- | --- |
| **논리적 읽기** | **300,044** | **44,772** | **약 85% 절감** |
| **CPU 시간** | **4,705ms** | **706ms** | **약 85% 단축** |
| **대기 시간** | 1,775ms | **115ms** | **약 93% 단축** |
| **최고 CPU 점유율** | **95.8%** | **안정화 수준** | 시스템 부하 해소 |

---

## 4. 상세 분석 및 성과

* **실행 계획 최적화**: 기존의 무거운 조인 및 스캔 방식에서 **Index Scan(NonClustered)** 및 효율적인 집계 방식으로 전환되어 실행 비용이 대폭 감소했습니다.
* **시스템 안정성 확보**: CPU 사용량이 과다했던 시간대(11:22 등)의 부하가 해소되어, 동일 서버 내 타 서비스의 안정적인 운영을 지원할 수 있게 되었습니다.
* **데이터 정합성 유지**: 통계 정보를 바탕으로 옵티마이저가 최적의 경로를 선택할 수 있도록 유도하여 쿼리 응답의 일관성을 확보했습니다.

---

## 5. 결론

이번 인덱스 개선은 단순히 쿼리 속도를 높인 것을 넘어, **서버 전체의 CPU 리소스를 확보**했다는 점에 큰 의미가 있습니다. 향후에도 데이터가 지속적으로 증가하는 `Log` 성격의 테이블에 대해서는 정기적인 인덱스 조각화(Fragmentation) 점검 및 통계 업데이트를 수행할 것을 권장합니다.

---
