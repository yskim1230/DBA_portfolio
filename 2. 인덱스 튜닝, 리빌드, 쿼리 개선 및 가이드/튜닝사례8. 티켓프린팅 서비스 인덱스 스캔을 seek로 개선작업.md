# TBL_TicketPrint 인덱스 최적화를 통한 조회 성능 개선

## 1. 현황 및 문제점 (Diagnosis)

* **증상**: `Chunjae_Main` 데이터베이스에서 특정 시간대(06:00)에 CPU 점유율 및 CPU Time(약 7,500ms)이 급증하는 현상 발생.
* **원인 분석**:
* `TBL_TicketPrint` 테이블 조회 시, 인덱스가 없는 `Seq` 컬럼이 조건절에 포함되어 **Clustered Index Scan**이 발생함.
* 약 20만 건의 행을 추출하기 위해 전체 데이터를 스캔하며 불필요한 자원을 소모함.
* **개선 전 IO**: 논리적 읽기 **13,854회** 발생.
![0  chunjae_main TBL_TicketPrint](https://github.com/user-attachments/assets/8e293c5e-371e-4ed0-a35e-17c7db1d0532)

![2  인덱스 생성 전 clustered index scan 중](https://github.com/user-attachments/assets/214ccfbb-eaec-4df0-8ffe-a5d978016f62)



## 2. 개선 조치 (Optimization)

* **인덱스 튜닝**: 검색 조건인 `Seq`와 출력 컬럼인 `UserId`를 포함하는 비클러스터형 인덱스를 생성하여 테이블 스캔을 방지함.
* **생성 내역**:
* **인덱스명**: `IDX_TBL_TicketPrint_Seq`
* **대상 컬럼**: `Seq`, `UserId`

[인덱스 생성 전/후]

![1  인덱스 생성 전, 후](https://github.com/user-attachments/assets/1fe69bef-e0cd-42b2-b74d-fdd364408b91)

[인덱스 생성 후 seek확인]
![3  인덱스 생성 후  index seek](https://github.com/user-attachments/assets/c6af3a83-7f77-46cc-a906-0f39dc21e7bd)



## 3. 개선 결과 (Results)

| 항목 | 개선 전 (Before) | 개선 후 (After) | 개선 효과 |
| --- | --- | --- | --- |
| **실행 계획** | **Clustered Index Scan** | **Index Seek** | 효율적 탐색으로 전환 |
| **논리적 읽기** | **13,854** | **592** | **약 95.7% 절감** |
| **CPU 시간** | 515ms | 187ms | **약 63% 단축** |
| **연산자 비용** | 94% (스캔 부하) | 0.65% (탐색 비용) | 시스템 안정성 확보 |

---

## 4. 기술적 포인트

* **커버링 인덱스(Covering Index) 효과**: 인덱스 구성 시 `UserId`를 포함하여, 실제 데이터 페이지에 접근하지 않고 인덱스 페이지만으로 쿼리 결과를 반환할 수 있도록 최적화되었습니다.
* **리소스 경합 해소**: 논리적 읽기 수의 급격한 감소는 메모리(Buffer Pool) 경합을 줄여, 동일 서버 내 다른 서비스들의 성능 간섭을 최소화하는 효과를 가져옵니다.

