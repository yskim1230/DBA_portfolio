듣고 싶은 말이 아니라, 들어야 할 말을 해줘

(답변 스타일 점검: 요청은 “같은 방식으로 특수 기호 제거”다. 별표, 굵게, 체크, 화살표, 따옴표, 대시 구분선, 괄호 강조 같은 “사람이 안 쓴 느낌”의 표시를 걷어내고 문장형으로 정리하겠다. 단, 기술 용어와 EXPLAIN 키워드는 그대로 둔다.)

---

# 튜닝 결과 요약 (EXPLAIN 기반)

## 1. 개선 전 병목(AS-IS)

* DEPENDENT SUBQUERY 다수 발생
  외부 row마다 NOT EXISTS, EXISTS가 반복 실행되는 구조
* done_ev 계산을 위해 EA_EV_RS 전체(약 129만 rows) 스캔 발생
  매 실행마다 큰 테이블을 한 번 훑는 구조적 비용이 존재

## 2. 개선 후 구조(TO-BE v2)에서 EXPLAIN이 보여주는 근거

### A. 대형 풀스캔 제거

* 현재 EXPLAIN에는 derived3가 없음
  EA_EV_RS 129만 rows 스캔 경로가 사라진 것으로 해석 가능
* 메인 집계에서 ER.EV_CMPL_YN = 'S' 조건으로 완료 여부를 계산하도록 변경한 효과

### B. 상관 서브쿼리 제거

* DEPENDENT SUBQUERY가 없음
  row 단위 반복 실행 구조가 제거됨

### C. 파생테이블은 1개(derived2, done_u)만 존재

* derived2는 조인키(auto_key0)로 붙고 Using index로 표시됨
  MySQL이 파생 결과에 자동 키를 생성해 조인 효율을 확보한 상태
* 비용 구조가 반복 실행이 아니라 1회 산출 후 조인 형태로 전환됨

## 3. 남아있는 Using temporary, Using filesort의 의미

* EXPLAIN 상단에서 EE에 Using temporary, Using filesort가 보임
* 이는 현 쿼리 형태상 자연스러운 비용으로 남을 수 있음

발생 요인

* GROUP BY TS.LU_LRMP_NOD_ID, EE.EV_DTL_DV_CD
* ORDER BY가 동일 키
* GROUP_CONCAT(DISTINCT ... ORDER BY ...) 포함

이 조합은 MySQL에서 임시테이블과 정렬이 동반되기 쉬움.
다만 이번 케이스의 1순위 병목은 이미 제거됨(129만 스캔, 상관서브쿼리).
남은 비용은 집계와 문자열 결합 성격이므로 추가 최적화는 필요 시점에 단계적으로 접근하는 전략이 합리적임.

## 4. 결론(추후 인덱스 권고 톤)

* 본 쿼리의 핵심 병목은 인덱스 부족이라기보다 상관 서브쿼리 반복 실행과 완료 여부 계산을 위한 대형 테이블 풀스캔에 기인함
* 1차 개선으로 쿼리를 리라이트하여 상관 서브쿼리를 제거했고, 완료 여부는 메인 조인 데이터에서 직접 집계하도록 변경하여 EA_EV_RS 전체 스캔 비용을 제거함(EXPLAIN 근거)
* 현재는 구조 개선 효과가 핵심이며, 향후 데이터 증가로 derived2(done_u) 산출 비용 또는 집계와 정렬 비용이 다시 증가하는 시점에 한해 EA_EV_RS, EA_EV_TS_RNGE 중심의 복합 인덱스 추가를 단계적으로 검토하는 전략을 권장함

## 5. 증적 강화를 위한 캡처 항목(선택)

* 배포 전후 비교로 아래 항목을 캡처하면 면접용 증적이 강해짐

  1. Avg latency
  2. Rows examined(가능하면)
  3. Total time per week

---
